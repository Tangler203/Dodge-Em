<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Dodge 'Em</title>

    <style type="text/css">
      canvas {
        border: 1px solid black;
      }
    </style>

  </head>

  <body>
      <canvas id="gameCanvas" width="800px" height="600px"></canvas>
      
      
      
      
      <script type="text/javascript">
          
          var circs = [];
          
          // Gets a handle to the element with id canvas
          var canvas = document.getElementById("gameCanvas");
          // Get a 2D context for the canvas.
          var ctx = canvas.getContext("2d");
          
          // How often balls spawn
          var spawnRate = 1500;
          // How fast they Fall
          var spawnRateOfDescent = 0.50;
          var lastSpawn = -1;
          
          // save the starting time (used to calc elapsed time)
          var time = Date.now();
          
          var player = {
              position: {x: 400, y: 450}
              , height: 40
              , width: 40
              , acceleration: {y: 0}
          }
        
         
          
          
          
          
          drawPlayer();
          step();
          
          
          
          
          
          
          

          function drawPlayer(){
              ctx.fillStyle = "rgb(0, 0, 255)";
              ctx.beginPath(); 
              ctx.rect(player.position.x, player.position.y, player.width, player.height);
              ctx.fill();
              ctx.closePath();
          }
          
          
          // The animation frame
          function step(t) {
              var time = Date.now(); // Gets current time
              
              
              if (time > (lastSpawn + spawnRate)) {
                  lastSpawn = time;
                  circ();
              }
              
              ctx.clearRect(0, 0, canvas.width, canvas.height);

              for (var i = 0; i < circs.length; i++) {
                  var object = circs[i];
                  //If Circle reaches bottom, remove from array.
                  if(object.y > canvas.height+10)
                      circs.splice(i,1); 
                  collisionCheck(object); // check if circle has touched square
                  
                  object.y += spawnRateOfDescent; // move circle
                  ctx.beginPath();
                  ctx.arc(object.x, object.y, 8, 0, Math.PI * 2);
                  ctx.closePath();
                  ctx.fillStyle = object.type;
                  ctx.fill();
              }
              drawPlayer();
              requestAnimationFrame(step);
          }
          
          
          // Player Movement - might replace with jquery
          
          window.addEventListener("keydown", function(event) { 
               ctx.clearRect(0, 0, canvas.width, canvas.height);
        
              if (event.keyCode == 37 && player.position.x > 0){
                  player.position.x -= 5;
              }
              else if (event.keyCode == 39 && player.position.x < canvas.width-player.width){
                  player.position.x += 5;
              }
               
              
              drawPlayer();
          });
          

          
          // Constructor
          function circ(){
          
              var Circle = {
                  // set this objects type
                  type: "red",
                  // sets x randomly
                  x: Math.floor(Math.random() * (canvas.width - 30) + 15),
                  // set y
                  y: -50,
              }
              
              // adds to array
              circs.push(Circle);
          }
          
          function collisionCheck(i){
          // checks if a circle is inside sqaure
          if(i.x - 8 < player.position.x + player.width && i.x + 8 > player.position.x && i.y < player.position.y + player.height && i.y + 8 > player.position.y){
              // if true do stuff i.e end game
              console.log("Collision detected");
          }
          }

          

    </script>
  </body>
</html>